import{u as _,d as h,A as N,j as e,n as q,e as i,o as S,p as v,q as p,s as F,G as $,t as I,v as k,w as y,m as w,x as A,y as E}from"./index-B1tvkX9G.js";const z=v().shape({name:p().required("Full name is required"),email:p().email("Invalid email").required("Email is required"),address:p().required("Address is required"),building:p().required("Building is required"),city:p().required("City is required"),zip:p().required("ZIP code is required")});function O({isGuest:a,prefilledData:u={},children:l}){var m,r,g,d,b,f;const o=_({resolver:S(z)}),{register:c,setValue:t,formState:{errors:n}}=o,{user:s}=h.useContext(N);return h.useEffect(()=>{!a&&s?(t("name",`${s.user_firstName||""} ${s.user_lastName||""}`.trim()),t("email",s.user_email||""),s.shipment_address&&(t("address",s.shipment_address.address||""),t("building",s.shipment_address.building||""),t("city",s.shipment_address.city||""),t("zip",s.shipment_address.zipCode||""))):u&&Object.entries(u).forEach(([x,C])=>{t(x,C||"")})},[a,s,u,t]),e(q,{...o,children:i("div",{className:"checkout-form",children:[e("h3",{children:a?"Guest Checkout":"Billing Information"}),e("label",{children:"Full Name"}),e("input",{...c("name")}),e("span",{className:"error",children:(m=n.name)==null?void 0:m.message}),e("label",{children:"Email"}),e("input",{...c("email")}),e("span",{className:"error",children:(r=n.email)==null?void 0:r.message}),e("label",{children:"Address"}),e("input",{...c("address")}),e("span",{className:"error",children:(g=n.address)==null?void 0:g.message}),e("label",{children:"Building"}),e("input",{...c("building")}),e("span",{className:"error",children:(d=n.building)==null?void 0:d.message}),e("label",{children:"City"}),e("input",{...c("city")}),e("span",{className:"error",children:(b=n.city)==null?void 0:b.message}),e("label",{children:"ZIP Code"}),e("input",{...c("zip")}),e("span",{className:"error",children:(f=n.zip)==null?void 0:f.message}),l]})})}function P(){const{handleSubmit:a,getValues:u}=F(),{cart:l,totalPrice:o}=h.useContext($),c=I(),n=o*.1,s=o+n;return i("form",{className:"order-summary",onSubmit:a(async r=>{if(l.length===0){y("Cart is empty");return}if(!r.address||!r.building||!r.city){y("Address, Building, and City are required");return}const g={shipment_address:{address:r.address,building:r.building,city:r.city},total_price:s,isPaid:!1,products:l.map(d=>({productId:d._id,quantity:d.quantity}))};try{const d=await w.post("https://ecommerce-final-project-server.onrender.com/orders/addOrder",g,{withCredentials:!0});d.data.success&&(localStorage.setItem("latestOrderId",d.data.order._id),localStorage.setItem("cart",JSON.stringify({items:l,createdAt:Date.now()})),A("✅ Order submitted successfully!"),c("/checkout/payment"))}catch(d){console.error("❌ Error submitting order:",d.response||d),y("Failed to submit order")}}),children:[e("h3",{children:"Order Summary"}),l.length===0?e("p",{children:"Your cart is empty."}):i(k,{children:[e("ul",{children:l.map(r=>i("li",{children:[r.product_name," x ",r.quantity," — $"," ",(r.product_price*r.quantity).toFixed(2)]},r._id))}),e("hr",{}),i("div",{className:"summary-line",children:[e("span",{children:"Subtotal:"}),i("span",{children:["$",o.toFixed(2)]})]}),i("div",{className:"summary-line",children:[e("span",{children:"Tax (10%):"}),i("span",{children:["$",n.toFixed(2)]})]}),i("div",{className:"summary-line total",children:[e("strong",{children:"Total:"}),i("strong",{children:["$",s.toFixed(2)]})]}),e("button",{type:"submit",className:"save-btn blue pay-now-btn",children:"Confirm & Pay"})]})]})}function B(){const{user:a,isAuth:u}=h.useContext(N),[l,o]=h.useState(!u),[c,t]=h.useState({}),[n,s]=h.useState(!1);return h.useEffect(()=>{if(u&&a){const m=a.shipment_address||{};t({name:`${a.user_firstName||""} ${a.user_lastName||""}`.trim(),email:a.user_email||"",address:m.address||"",building:m.building||"",city:m.city||"",zip:m.zipCode||""}),o(!1)}else o(!0),t({})},[u,a]),i("div",{className:"checkout-container",children:[i("div",{className:"checkout-left",children:[l&&e("div",{className:"guest-message",children:i("p",{children:["Already have an account?"," ",e("button",{onClick:()=>s(!0),children:"Sign in"})]})}),e(O,{isGuest:l,prefilledData:c,children:e(P,{})})]}),e(E,{show:n,handleClose:()=>s(!1)})]})}export{B as default};
