import{d as u,A as x,j as e,e as a,N as l,v as S,m as _,x as v,w as m}from"./index-BnvfVVTl.js";import{f as F}from"./Date-C1a8zvga.js";/* empty css                      */import{D as M}from"./DeleteAccountModal-DjCEM9Lz.js";function j(){const{user:r,setUser:N}=u.useContext(x),[s,w]=u.useState({user_firstName:"",user_lastName:"",user_phone:"",user_email:"",user_birthDate:"",gender:"Other",user_password:"",newPassword:"",confirmPassword:""}),[p,h]=u.useState(!1),[y,b]=u.useState(!0);u.useEffect(()=>{r&&(w({user_firstName:r.user_firstName||"",user_lastName:r.user_lastName||"",user_phone:r.user_phone||"",user_email:r.user_email||"",user_birthDate:r.user_birthDate?F(r.user_birthDate,"yyyy-MM-dd"):"",gender:r.gender||"Other",user_password:"",newPassword:"",confirmPassword:""}),b(!1))},[r]);const o=d=>{const{name:t,value:n}=d.target;w(i=>({...i,[t]:n}))},C=async d=>{var t,n;d.preventDefault();try{h(!0);const{user_password:i,newPassword:f,confirmPassword:c,...g}=s,P=await _.put(`https://ecommerce-final-project-server.onrender.com/users/update-profile/${r._id}`,g,{withCredentials:!0});P.data.success&&(v("Profile updated successfully!"),N(P.data.user))}catch(i){m(`Failed to update profile: ${(n=(t=i.response)==null?void 0:t.data)==null?void 0:n.message}`)}finally{h(!1)}},D=async()=>{var d,t,n,i,f;if(console.log("Password formData:",{user_password:s.user_password,new_password:s.newPassword,confirm_password:s.confirmPassword}),!s.user_password||!s.newPassword||!s.confirmPassword){m("All password fields are required.");return}if(s.newPassword!==s.confirmPassword){m("Passwords do not match.");return}if(s.newPassword.length<8){m("Password must be at least 8 characters.");return}try{h(!0),(await _.put(`https://ecommerce-final-project-server.onrender.com/users/change-password/${r._id}`,{user_password:s.user_password,new_password:s.newPassword,confirm_password:s.confirmPassword},{withCredentials:!0})).data.success&&(v("Password updated successfully!"),w(g=>({...g,user_password:"",newPassword:"",confirmPassword:""})))}catch(c){console.error("Password update error:",(d=c.response)==null?void 0:d.data),m(((n=(t=c.response)==null?void 0:t.data)==null?void 0:n.error)||((f=(i=c.response)==null?void 0:i.data)==null?void 0:f.message)||"Failed to update password. Try again.")}finally{h(!1)}};return y?e("div",{className:"content",children:e("h2",{children:"Loading profile..."})}):a("div",{className:"account-page",children:[a("div",{className:"sidebar",children:[a(l,{to:"/account",className:"sidebar-item active",children:[e("i",{className:"fas fa-user"})," Personal Info"]}),a(l,{to:"/payment-method",className:"sidebar-item",children:[e("i",{className:"fas fa-credit-card"})," Payment Methods"]}),a(l,{to:"/MyOrder",className:"sidebar-item",children:[e("i",{className:"fas fa-box"})," My Orders"]}),a(l,{to:"/shipping-info",className:"sidebar-item",children:[e("i",{className:"fas fa-truck"})," Shipping Info"]}),a(l,{to:"/my-favorite",className:"sidebar-item",children:[e("i",{className:"fas fa-star"})," Favorites"]}),e(M,{})]}),a("div",{className:"content",children:[e("h2",{children:"Personal Information"}),a("form",{onSubmit:C,children:[a("div",{className:"form-row",children:[e("input",{type:"text",name:"user_firstName",value:s.user_firstName,onChange:o,placeholder:"First Name",required:!0}),e("input",{type:"text",name:"user_lastName",value:s.user_lastName,onChange:o,placeholder:"Last Name",required:!0})]}),a("div",{className:"form-row",children:[e("input",{type:"tel",name:"user_phone",value:s.user_phone,onChange:o,placeholder:"Phone"}),e("input",{type:"email",name:"user_email",value:s.user_email,onChange:o,placeholder:"Email",required:!0})]}),a("div",{className:"form-row",children:[e("input",{type:"date",name:"user_birthDate",value:s.user_birthDate,onChange:o}),a("select",{name:"gender",value:s.gender,onChange:o,children:[e("option",{value:"",disabled:!0,children:"Select Gender"}),e("option",{value:"Male",children:"Male"}),e("option",{value:"Female",children:"Female"}),e("option",{value:"Other",children:"Other"})]})]}),e("button",{type:"submit",className:"save-btn blue",disabled:p,children:p?"Saving...":"Save Changes"})]}),(r==null?void 0:r.SignUpProvider)!=="Google"&&a(S,{children:[e("h2",{children:"Change Password"}),a("div",{className:"password-container",children:[a("div",{className:"password-inputs",children:[e("input",{type:"password",name:"user_password",placeholder:"Current Password",value:s.user_password,onChange:o}),e("input",{type:"password",name:"newPassword",placeholder:"New Password",value:s.newPassword,onChange:o}),e("input",{type:"password",name:"confirmPassword",placeholder:"Confirm Password",value:s.confirmPassword,onChange:o})]}),a("div",{className:"password-instructions",children:[e("h4",{children:"Password Instructions:"}),a("ul",{children:[e("li",{children:"At least 8 characters"}),e("li",{children:"Includes a number and special character"}),e("li",{children:"Not same as previous password"})]})]})]}),e("button",{onClick:D,className:"save-btn yellow",disabled:p,children:p?"Updating...":"Update Password"})]}),(r==null?void 0:r.SignUpProvider)==="Google"&&a("div",{className:"no-password-card",children:[e("h3",{children:"Create Your Password"}),a("p",{children:["It looks like you signed up with Google. To set a password, please log out and use the ",e("strong",{children:'"Forgot Password"'})," option on the login page."]}),e("p",{children:"This will allow you to login without Google in the future."}),e(l,{to:"/reset-password",style:{textDecoration:"none"},children:e("button",{className:"save-btn yellow",style:{margin:"auto"},children:"Reset Password"})})]})]})]})}export{j as default};
