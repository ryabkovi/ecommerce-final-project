import{d as i,A as x,e as r,j as s,N as n,m as N,w as g,x as w}from"./index-B1tvkX9G.js";import{f as _}from"./Date-C1a8zvga.js";import{D as S}from"./DeleteAccountModal-DPzZQ2Rl.js";function j(){const{user:m}=i.useContext(x),[h,f]=i.useState([]),[p,l]=i.useState([]),[y,v]=i.useState("all"),[O,u]=i.useState(!1);i.useEffect(()=>{m&&(async()=>{var t,c;try{u(!0);const a=await N.get("https://ecommerce-final-project-server.onrender.com/orders/getUserOrders",{withCredentials:!0});a.data.success&&(f(a.data.orders),l(a.data.orders))}catch(a){g(((c=(t=a.response)==null?void 0:t.data)==null?void 0:c.message)||"Failed to fetch orders")}finally{u(!1)}})()},[m]);const b=e=>{v(e),l(e==="all"?h:h.filter(t=>t.status===e))},C=async e=>{var t,c;if(window.confirm("Are you sure you want to cancel this order?"))try{(await N.delete(`https://ecommerce-final-project-server.onrender.com/orders/deleteOrder/${e}`,{withCredentials:!0})).data.success&&(w("✅ Order canceled successfully"),f(d=>d.filter(o=>o._id!==e)),l(d=>d.filter(o=>o._id!==e)))}catch(a){g(((c=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:c.error)||"Failed to delete order")}};return r("div",{className:"my-order-page",children:[r("div",{className:"sidebar",children:[r(n,{to:"/account",className:"sidebar-item",children:[s("i",{className:"fas fa-user"})," Personal Info"]}),r(n,{to:"/payment-method",className:"sidebar-item",children:[s("i",{className:"fas fa-credit-card"})," Payment Methods"]}),r(n,{to:"/my-order",className:"sidebar-item active",children:[s("i",{className:"fas fa-box"})," My Orders"]}),r(n,{to:"/shipping-info",className:"sidebar-item",children:[s("i",{className:"fas fa-truck"})," Shipping Info"]}),r(n,{to:"/favorites",className:"sidebar-item",children:[s("i",{className:"fas fa-star"})," Favorites"]}),s(S,{})]}),r("div",{className:"content",children:[s("h2",{children:"My Orders"}),s("div",{className:"filter-buttons",children:["all","new","process","completed","Canceled"].map(e=>s("button",{className:`filter-btn ${y===e?"active":""}`,onClick:()=>b(e),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),O?s("p",{children:"Loading orders..."}):p.length>0?s("ul",{className:"order-list",children:p.map(e=>r("li",{className:"order-item",children:[r("div",{className:"order-details",children:[r("span",{children:[s("strong",{children:"Order #:"})," ",e.order_number??e._id.slice(-6).toUpperCase()]}),r("span",{children:[s("strong",{children:"Date:"})," ",_(e.createdAt)]}),r("span",{children:[s("strong",{children:"Status:"})," ",s("span",{className:`status-${e.status}`,children:e.status})]}),s("button",{className:"delete-order-btn",onClick:()=>C(e._id),children:"❌ Cancel Order"})]}),s("div",{className:"order-products",children:e.products.map((t,c)=>{var a,d;return r("div",{className:"order-product",children:[s("span",{children:(a=t.productId)==null?void 0:a.product_name}),r("span",{children:[t.quantity," x $",(d=t.productId)==null?void 0:d.product_price]})]},c)})})]},e._id))}):s("p",{children:"No orders found."})]})]})}export{j as default};
