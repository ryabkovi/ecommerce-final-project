import{t as j,d as r,A as E,G as M,w as d,j as e,e as t,P as O,m as l,x as C}from"./index-B1tvkX9G.js";/* empty css                      */function F(){const s=j(),{user:n,getAuth:p}=r.useContext(E),{totalPrice:i,getAllProducts:y,clearCart:h}=r.useContext(M),[u,x]=r.useState(null),[P,f]=r.useState(!1),[c,m]=r.useState(""),[g,N]=r.useState([]),v=i*.1,I=i+v;r.useEffect(()=>{const a=localStorage.getItem("latestOrderId"),o=JSON.parse(localStorage.getItem("cart")),w=(o==null?void 0:o.items)||[];!a||w.length===0?(d("No order found or cart is empty. Redirecting..."),s("/checkout")):(x(a),N(w))},[s]),r.useEffect(()=>{n!=null&&n.paymentMethod&&m(n.paymentMethod)},[n]);const S=async()=>{if(!c){d("Please select a payment method");return}try{f(!0),await l.put(`https://ecommerce-final-project-server.onrender.com/users/update-profile/${n._id}`,{paymentMethod:c},{withCredentials:!0}),await l.put(`https://ecommerce-final-project-server.onrender.com/orders/confirm/${u}`,{},{withCredentials:!0}),C("Payment successful!"),h(),localStorage.removeItem("cart"),localStorage.removeItem("latestOrderId"),await y(),await p(),s("/payment-success")}catch(a){d(a.message||"Payment failed"),s("/payment-failed")}finally{f(!1)}},b=async()=>{if(g.length===0)throw new Error("Cart is empty, cannot create PayPal order.");try{const{data:a}=await l.post("https://ecommerce-final-project-server.onrender.com/payment/create-order",{cart:g},{headers:{"Content-Type":"application/json"},withCredentials:!0});return a.orderId}catch(a){throw console.error("âŒ Error creating PayPal order:",a),new Error("Failed to create PayPal order")}},$=async a=>{try{if((await l.post("https://ecommerce-final-project-server.onrender.com/payment/capture-order",{orderId:a.orderID},{headers:{"Content-Type":"application/json"},withCredentials:!0})).data.status!=="COMPLETED")throw new Error("Payment not completed");await l.put(`https://ecommerce-final-project-server.onrender.com/orders/confirm/${u}`,{},{withCredentials:!0}),C("âœ… PayPal Payment successful!"),h(),localStorage.removeItem("cart"),localStorage.removeItem("latestOrderId"),await y(),await p(),s("/payment-success")}catch(o){console.error(o),d(o.message||"Payment failed"),s("/payment-failed")}};return n?e("div",{className:"payment-page",children:t("div",{className:"payment-container",children:[e("h2",{className:"payment-title",children:"Confirm Your Payment"}),t("div",{className:"payment-summary-box",children:[t("div",{className:"payment-summary-row",children:[e("span",{children:"Subtotal:"}),t("span",{children:["$",i.toFixed(2)]})]}),t("div",{className:"payment-summary-row",children:[e("span",{children:"Tax (10%):"}),t("span",{children:["$",v.toFixed(2)]})]}),t("div",{className:"payment-summary-row total",children:[e("strong",{children:"Total:"}),t("strong",{children:["$",I.toFixed(2)]})]})]}),t("div",{className:"payment-method-info",children:[e("h4",{children:"Select Payment Method"}),t("div",{className:"payment-options",children:[t("label",{children:[e("input",{type:"radio",name:"paymentMethod",value:"card",checked:c==="card",onChange:()=>m("card")}),"ðŸ’³ Credit Card"]}),t("label",{children:[e("input",{type:"radio",name:"paymentMethod",value:"paypal",checked:c==="paypal",onChange:()=>m("paypal")}),"ðŸ’° PayPal"]})]})]}),c==="card"&&e("button",{onClick:S,className:"save-btn blue pay-now-btn",disabled:P,children:P?"Processing...":"ðŸ’¸ Pay Now"}),c==="paypal"&&e("div",{style:{marginTop:"20px"},children:e(O,{style:{layout:"horizontal",shape:"pill",color:"blue",tagline:!1},createOrder:b,onApprove:$})})]})}):e("div",{className:"payment-page",children:e("div",{className:"payment-container",children:e("h2",{className:"payment-title",children:"Loading..."})})})}export{F as default};
